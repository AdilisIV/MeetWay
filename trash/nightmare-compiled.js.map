{"version":3,"sources":["nightmare.js"],"names":[],"mappings":"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","file":"nightmare-compiled.js","sourcesContent":["var express = require('express');\nvar bodyParser = require('body-parser');\nvar MongoClient = require('mongodb').MongoClient;\nvar ObjectID = require('mongodb').ObjectID;\nvar db = require('./../db');\n//var eventsController = require('./../controllers/events');\nvar path = require('path');\nvar request = require('request');\nvar cheerio = require('cheerio');\nvar fs = require('fs');\nvar app = express();\nconst VK = require('vk-io');\nconst vk = new VK({\n    app: 5980502,\n    login: 'ilia.fyodoroff@mail.ru',\n    pass: 'zxcfghb12QLNkftMGS44078',\n    phone: '+79220291925',\n    scope: 'stats,notifications,groups,wall,pages,friends,offline,photos,market'\n});\nvar jquery = require('jquery');\nvar Nightmare = require('nightmare');\nnightmare = Nightmare({ show: true, dock: true });\n\nvar groupID = [];\nvar groupName = [];\nvar groupActivity = [];\nvar groupMembers = [];\nvar groupPhoto = [];\nvar groupStartdate= [];\nvar groupLatitude = [];\nvar groupLongitude = [];\nvar eventsArr = [];\n\nvar CitiesID = ['96'];\nvar ABC = [\"в\", \"c\"];\n\n\napp.use(bodyParser.json());\napp.use(bodyParser.urlencoded({ extended: true }));\nconst auth = vk.auth.standalone();\n\n\nfunction arrayUnique(arr){\n    return arr.filter((e,i,a)=>a.indexOf(e)==i)\n}\nfunction compareStart(eventA, eventB) {\n    return eventA.start - eventB.start;\n}\nfunction cleaningGlobalValues() {\n    groupID.length = 0;\n    groupName.length = 0;\n    groupActivity.length = 0;\n    groupMembers.length = 0;\n    groupPhoto.length = 0;\n    groupStartdate.length = 0;\n    groupLatitude.length = 0;\n    groupLongitude.length = 0;\n    eventsArr.length = 0;\n}\n\nfunction parseDataFromSite(c) {\n    return function () {\n        nightmare.goto('https://vk.com/search?c%5Bcity%5D=' + CitiesID[c] + '&c%5Bcountry%5D=1&c%5Bsection%5D=communities&c%5Bskip_catalog%5D=1&c%5Btype%5D=3')\n            .wait(2000)\n            .inject('js', './jquery_v1_10_2.js')\n            .wait(2000)\n            .scrollTo(9999999999999999999999999999999,0)\n            .wait(5000)\n            .evaluate(function () {\n                var shortNames = [];\n                $('.labeled.title a').each(function () {\n                    var item = $(this).attr('href');\n                    $.trim(item);\n                    item = item.replace('/','');\n                    item = item.replace('event','club');\n                    shortNames.push(item)\n                });\n\n                shortNames = shortNames.join(',');\n\n                return new Promise(function (resolve, reject) {\n                    setTimeout(() => resolve(shortNames), 1000);\n                })\n            })\n            .then(function (result) {\n                return new Promise(function (resolve, reject) {\n                    console.info(result);\n                    vk.api.groups.getById({\n                            group_ids: result,\n                            fields: 'members_count,start_date,activity,place'\n                        })\n                        .then((data) => {\n                            console.log(data);\n\n                            var Event = {\n                                id: String,\n                                name: String,\n                                activity: String,\n                                photo: String,\n                                start: Number,\n                                members: Number,\n                                latitude: Number,\n                                longitude: Number\n                            };\n\n                            var id = [];\n                            var name = [];\n                            var activity = [];\n                            var photo = [];\n                            var start = [];\n                            var members = [];\n                            var latitude = [];\n                            var longitude = [];\n\n                            var gLatitude = 0;\n                            var gLongitude = 0;\n                            var gMembers = 0;\n                            var gActivity = \"Данные недоступны\";\n                            var gStartDate = 2001513200;\n\n\n                            var dataObj = JSON.stringify(data);\n                            var dataJSON = JSON.parse(dataObj);\n\n                            for (var i = 0; i < dataJSON.length; i++) {\n\n                                var place = dataJSON[i].place;\n                                if (place) {\n                                    gLatitude = dataJSON[i].place.latitude;\n                                    gLongitude = dataJSON[i].place.longitude;\n                                } else {\n                                    console.info('Адрес проведения мероприятий не указан организаторами');\n                                }\n\n                                if (dataJSON[i].is_closed == 0) {\n                                    gActivity = dataJSON[i].activity;\n                                    gMembers = dataJSON[i].members_count;\n                                    gStartDate = dataJSON[i].start_date;\n                                } else {\n                                    console.info('Частное сообщество');\n                                }\n\n                                id.push(dataJSON[i].id);\n                                name.push(dataJSON[i].name);\n                                activity.push(gActivity);\n                                photo.push(dataJSON[i].photo_200);\n                                start.push(gStartDate);\n                                members.push(gMembers);\n                                latitude.push(gLatitude);\n                                longitude.push(gLongitude);\n\n                            }\n\n                            console.log(\"Длинна массива с members: \", id.length);\n                            console.log(\"Длинна массива с members: \", name.length);\n                            console.log(\"Длинна массива с members: \", activity.length);\n                            console.log(\"Длинна массива с members: \", photo.length);\n                            console.log(\"Длинна массива с members: \", start.length);\n                            console.log(\"Длинна массива с members: \", members.length);\n                            console.log(\"Длинна массива с members: \", latitude.length);\n                            console.log(\"Длинна массива с members: \", longitude.length);\n\n                        })\n                })\n            })\n            .catch((error) => {\n                console.error(error);\n            });\n    }\n}\n\n\nsetTimeout(parseDataFromSite(0), 3500*(1)); // Сбор, сортировка, запись\n\n\ndb.connect(\"mongodb://localhost:27017/VK_eAPI\", function (err) { // VK_eAPI or test\n    if(err) { return console.log(err); }\n    app.listen(1337, function () {\n        console.log(\"API app started\");\n    });\n});\n\n// .cookies.set({\n//     _ym_uid: '1480693391430570032',\n//     remixdt: '7200',\n//     remixflash: '25.0.0',\n//     remixlang: '0',\n//     remixlhk: 'b2bb8ecdcf35e20998',\n//     remixmdevice: '1366/768/1/!!-!!!!',\n//     remixrefkey: 'e6183419d1c7983866',\n//     remixscreen_depth: '24',\n//     remixseenads: '0',\n//     remixsid: 'ba872a5f3cb886f2d96ed73397c6c6e68c7d44a3aa27f4bc49ec1',\n//     remixsslsid: '1',\n//     remixstid: '1027994728_432392ce1cfdbbb4cb',\n//     remixvkcom:\t'1'\n// })"]}