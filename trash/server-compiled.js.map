{"version":3,"sources":["server.js"],"names":[],"mappings":"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","file":"server-compiled.js","sourcesContent":["var express = require('express');\nvar bodyParser = require('body-parser');\nvar MongoClient = require('mongodb').MongoClient;\nvar ObjectID = require('mongodb').ObjectID;\nvar db = require('./../db');\nvar eventsController = require('./../controllers/events');\nvar getGroupsData = require('./../controllers/getGroups');\nvar path = require('path');\nvar request = require('request');\nvar cheerio = require('cheerio');\nvar fs = require('fs');\nvar encoding = require('encoding');\nvar jquery = require('jquery');\nvar Nightmare = require('nightmare');\n    nightmare = Nightmare({ show: true, dock: true });\nvar app = express();\nconst VK = require('vk-io');\nconst vk = new VK({\n    app: 5980502,\n    login: '',\n    pass: '',\n    phone: '',\n    scope: 'stats,notifications,groups,wall,pages,friends,offline,photos,market'\n});\n//var ABC = [\"в\",\"с\",\"до\",\"от\",\"2017\",\"по\",\"на\",\"за\",\"для\",\"фестиваль\",\"день\",\"уроки\",\"встреча\",\"отдых\",\"МК\"];\n//var CitiesID = [96, 1, 2, 10, 37, 153, 49, 60, 61, 72, 73, 95, 99, 104, 110, 119, 123, 151, 158];\n//var CitiesID = ['96','1','2','10','37','153','49','60','61','72','73','95','99','104','110','119','123','151','158'];\nvar ABC = [\"в\"];\nvar CitiesID = ['96'];\n\nvar result = [];\nvar mergeName = [];\n\nvar groupID = [];\nvar groupName = [];\nvar groupActivity = [];\nvar groupPhoto = [];\nvar groupStartdate= [];\nvar groupLatitude = [];\nvar groupLongitude = [];\n\napp.use(bodyParser.json());\napp.use(bodyParser.urlencoded({ extended: true }));\nconst auth = vk.auth.standalone();\n\nfunction arrayUnique(arr){\n    return arr.filter((e,i,a)=>a.indexOf(e)==i)\n}\n\n\n\n\n\nfunction parseDataFromSite(c) {\n    nightmare.goto('https://vk.com/search?c%5Bcity%5D=' + CitiesID[c] + '&c%5Bcountry%5D=1&c%5Bsection%5D=communities&c%5Bskip_catalog%5D=1&c%5Btype%5D=3')\n        .wait(2000)\n        .inject('js', './jquery_v1_10_2.js')\n        .wait(3000)\n        .inject('js', './scrollAnimate.js')\n        .wait(15000)\n        .evaluate(function () {\n            var shortNames = [];\n            $('.labeled.title a').each(function () {\n                var item = $(this).attr('href');\n                $.trim(item);\n                item = item.replace('/','');\n                item = item.replace('event','club');\n                shortNames.push(item)\n            });\n\n            console.log('shortNames:', shortNames);\n\n            shortNames = shortNames.join(',');\n\n            return shortNames;\n        })\n        .then(function (result) {\n            return new Promise(function (resolve, reject) {\n                console.info(result);\n                vk.api.groups.getById({\n                        group_ids: result,\n                        fields: 'members_count,start_date,activity,place'\n                    })\n                    .then((data) => {\n                        console.log(data);\n\n                        var Event = {\n                            id: String,\n                            name: String,\n                            activity: String,\n                            photo: String,\n                            start: Number,\n                            members: Number,\n                            latitude: Number,\n                            longitude: Number\n                        };\n\n                        var id = [];\n                        var name = [];\n                        var activity = [];\n                        var photo = [];\n                        var start = [];\n                        var members = [];\n                        var latitude = [];\n                        var longitude = [];\n\n                        var gLatitude = 0;\n                        var gLongitude = 0;\n                        var gMembers = 0;\n                        var gActivity = \"Данные недоступны\";\n                        var gStartDate = 2001513200;\n\n\n                        var dataObj = JSON.stringify(data);\n                        var dataJSON = JSON.parse(dataObj);\n\n                        for (var i = 0; i < dataJSON.length; i++) {\n\n                            var place = dataJSON[i].place;\n                            if (place) {\n                                gLatitude = dataJSON[i].place.latitude;\n                                gLongitude = dataJSON[i].place.longitude;\n                            } else {\n                                console.info('Адрес проведения мероприятий не указан организаторами');\n                            }\n\n                            if (dataJSON[i].is_closed == 0) {\n                                gActivity = dataJSON[i].activity;\n                                gMembers = dataJSON[i].members_count;\n                                gStartDate = dataJSON[i].start_date;\n                            } else {\n                                console.info('Частное сообщество');\n                            }\n\n                            id.push(dataJSON[i].id);\n                            name.push(dataJSON[i].name);\n                            activity.push(gActivity);\n                            photo.push(dataJSON[i].photo_200);\n                            start.push(gStartDate);\n                            members.push(gMembers);\n                            latitude.push(gLatitude);\n                            longitude.push(gLongitude);\n\n                        }\n\n                        console.log(\"Длинна массива с members: \", id.length);\n                        console.log(\"Длинна массива с members: \", name.length);\n                        console.log(\"Длинна массива с members: \", activity.length);\n                        console.log(\"Длинна массива с members: \", photo.length);\n                        console.log(\"Длинна массива с members: \", start.length);\n                        console.log(\"Длинна массива с members: \", members.length);\n                        console.log(\"Длинна массива с members: \", latitude.length);\n                        console.log(\"Длинна массива с members: \", longitude.length);\n\n                        for (var l=0; l<id.length; l++) {\n                            request.post({\n                                url: 'http://localhost:1337/events/'+CitiesID[c],\n                                form: {\n                                    id: id[l],\n                                    name: name[l],\n                                    activity: activity[l],\n                                    photo: photo[l],\n                                    start: start[l],\n                                    members: members[l],\n                                    latitude: latitude[l],\n                                    longitude: longitude[l]\n                                }\n                            }, function (err, res, body) {\n                                if (err) {\n                                    console.log(err);\n                                } else if (body) {\n                                    console.log(body);\n                                }\n                            });\n                        }\n\n                        //resolve(eventsArr);\n                    })\n            })\n        })\n}\n\n\n\n// Get Groups ID\n\n/*auth.run()\n    .then((token) => {\n        console.log('User token:',token);\n        vk.setToken(token);\n        for (var c = 0; c<CitiesID.length; c++) { // цикл для сбора данных по всем городам\n            for (var j = 0; j<ABC.length; j++) { // цикл для сбора данных по всем поисковым словам\n                setTimeout(tryGetGroupData(j,c), 1000*(j+1)); // Groups.search\n            }\n        }\n    }, () => console.error('Ошибка при получении токена.'))\n    .catch((error) => {\n        console.error(error);\n    });*/\n\n\n\n//parseDataFromSite(0);\n\n\n\n\n\n// API methods\n\napp.get('/', function (req, res) {\n    res.send(\"OneTwoMeet.ru started!\");\n});\napp.get('/events', eventsController.all);\n\napp.get('/events/:id', eventsController.findById);\n\napp.post('/events/:cityid', eventsController.create);\n\n//app.put('/events/:id', eventsController.update);\n\napp.delete('/events/:id', eventsController.delete);\n\n\ndb.connect(\"mongodb://localhost:27017/VK_eAPI\", function (err) { // VK_eAPI or test\n    if(err) { return console.log(err); }\n    app.listen(1337, function () {\n        console.log(\"API app started\");\n    });\n});"]}