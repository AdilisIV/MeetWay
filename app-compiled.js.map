{"version":3,"sources":["app.js"],"names":[],"mappings":"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","file":"app-compiled.js","sourcesContent":["\nvar express = require('express');\nvar bodyParser = require('body-parser');\nvar db = require('./db');\nvar eventsController = require('./controllers/events');\nvar path = require('path');\nvar request = require('request');\nvar fs = require('fs');\nvar app = express();\nconst VK = require('vk-io');\n// +79220337451\n// OneTwoMeet\nconst vk = new VK({\n    app: 5980502,\n    login: 'ilia.fyodoroff@mail.ru',\n    pass: 'zxcfghb12QLNkftMGS44078',\n    phone: '+79220291925',\n    scope: 'stats,notifications,groups,wall,pages,friends,offline,photos,market'\n});\nvar jquery = require('jquery');\nvar Nightmare = require('nightmare');\nnightmare = Nightmare({ show: true, dock: true });\nvar schedule = require('node-schedule');\nvar rule = new schedule.RecurrenceRule();\nrule.hour = new schedule.Range(0, 59, 12);\n\n\n\nvar CitiesID = ['96','1','2','10','37','153','49','60','61','72','73','95','99','104','110','119','123','151','158','133'];\n\nvar CitiesName = ['Нижний Тагил','Москва','Санкт-Петербург','Волгоград','Владивосток','Хабаровск','Екатеринбург','Казань','Калининград','Краснодар','Красноярск','Нижний Новгород','Новосибирск','Омск','Пермь','Ростов-на-Дону','Самара','Уфа','Челябинск','Сочи'];\n\nvar ABC = [\"в\",\"с\",\"до\",\"от\",\"к\",\"2017\",\"по\",\"и\",\"на\",\"за\",\"для\",\"фестиваль\",\"день\",\"уроки\",\"встреча\",\"отдых\",\"МК\",\"выиграй\",\"спектакль\",\"кубок\",\"приз\",\"репост\",\"ночь\",\"концерт\",\"курс\",\"школа\",\"шоу\",\"турнир\",\"розыгрыш\",\"тренинг\",\"интенсив\",\"через\",\"обучение\",\"клуб\",\"вечеринка\",\"билеты\",\"dance\",\"street\",\"тур\",\"халява\",\"забег\",\"форум\",\"афиша\",\"волна\",\"бизнес\",\"хутор\",\"кино\",\"поход\",\"фитнес\",\"сказка\",\"семинар\",\"выставка\",\"москва\",\"of\",\"|\"];\n\n//var CitiesID = ['96'];\n//var ABC = ['в', 'с'];\n\n//var email = 'ilia.fyodoroff@mail.ru';\n//var password = 'zxcfghb12QLNkftMGS44078';\n\napp.use(bodyParser.json());\napp.use(bodyParser.urlencoded({ extended: true }));\nconst auth = vk.auth.standalone();\n\n\nfunction arrayUnique(arr){\n    return arr.filter((e,i,a)=>a.indexOf(e)==i)\n}\nfunction compareStart(eventA, eventB) {\n    return eventA.start - eventB.start;\n}\n\n\nfunction setCities() {\n    setTimeout(function(){\n        for (var l=0; l<CitiesID.length; l++) {\n            request.post({\n            url: 'http://localhost:1337/cities',\n            form: {\n                id: CitiesID[l],\n                name: CitiesName[l]\n            }\n            }, function (err, res, body) {\n                if (err) {\n                    console.log(err);\n                } else if (body) {\n                    console.log(body);\n                }\n            });\n        }\n    }, 2000);\n}\n\n\nfunction parseDataViaAPI(j,c) {\n    return function () {\n        // auth.run()\n        //     .then((token) => {\n        //         console.log('User token:', token);\n        //         vk.setToken(token);\n                vk.api.groups.search({\n                        q: ABC[j], // j\n                        type: 'event',\n                        city_id: CitiesID[c], // c\n                        future: 1,\n                        offset: 0,\n                        count: 1000\n                    })\n                    .then((group) => {\n                        var result = [];\n                        console.log('Первое поиское слово: ', ABC[j]); // j\n                        var groupObj = JSON.stringify(group);\n                        var groupJSON = JSON.parse(groupObj);\n                        for (var i = 0; i < groupJSON.items.length; i++) {\n                            result.push(groupJSON.items[i].screen_name); // все id по словарю для заданного города\n                        }\n                        result = arrayUnique(result); // удаляем дублирующиеся данные\n                        result = result.join(',');\n\n                        return result;\n                    })\n                    .then(function (result) {\n                        return new Promise(function (resolve, reject) {\n                            //console.info('Result (api по букве словаря): ',result);\n                            vk.api.groups.getById({\n                                    group_ids: result,\n                                    fields: 'members_count,start_date,activity,place,description'\n                                })\n                                .then((data) => {\n                                    //console.log(data);\n                                    //cleaningGlobalValues();\n\n                                    var id = [];\n                                    var name = [];\n                                    var activity = [];\n                                    var photo = [];\n                                    var start = [];\n                                    var members = [];\n                                    var latitude = [];\n                                    var longitude = [];\n                                    var description = [];\n\n                                    var gLatitude = 0;\n                                    var gLongitude = 0;\n                                    var gMembers = 0;\n                                    var gActivity = \"Данные недоступны\";\n                                    var gStartDate = 2001513200;\n                                    var gDescription = \"Упс, видимо организаторы мероприятия решили не добавлять описание. :(\";\n\n\n\n                                    var dataObj = JSON.stringify(data);\n                                    var dataJSON = JSON.parse(dataObj);\n\n\n                                    for (var i = 0; i < dataJSON.length; i++) {\n\n                                        var place = dataJSON[i].place;\n                                        if (place) {\n                                            gLatitude = dataJSON[i].place.latitude;\n                                            gLongitude = dataJSON[i].place.longitude;\n                                        } else {\n                                            //console.info('Адрес проведения мероприятий не указан организаторами');\n                                        }\n\n                                        if (dataJSON[i].is_closed == 0) {\n                                            gActivity = dataJSON[i].activity;\n                                            gMembers = dataJSON[i].members_count;\n                                            gStartDate = dataJSON[i].start_date;\n                                        } else {\n                                            //console.info('Частное сообщество');\n                                        }\n\n                                        if(dataJSON[i].description != \"\") {\n                                            gDescription = dataJSON[i].description;\n                                        } else {\n                                            console.info('У сообщества нет описания', dataJSON[i].id);\n                                        }\n\n                                        if ((gMembers == 0) || (gMembers == 1)) {\n                                            //console.log(\"Число участников: \", gMembers);\n                                            //console.log(\"Аватар сообщества: \", dataJSON[i].photo_200);\n                                            //console.log('ПУСТОЕ СООБЩЕСТВО');\n                                        } else {\n                                            id.push(dataJSON[i].id);\n                                            name.push(dataJSON[i].name);\n                                            activity.push(gActivity);\n                                            photo.push(dataJSON[i].photo_200);\n                                            start.push(gStartDate);\n                                            members.push(gMembers);\n                                            latitude.push(gLatitude);\n                                            longitude.push(gLongitude);\n                                            description.push(gDescription);\n                                        }\n\n\n                                    }\n\n                                    for (var l=0; l<id.length; l++) {\n                                        //console.log('XXXXXXX----XXXXXX', l);\n                                        request.post({\n                                            url: 'http://localhost:1337/events/'+CitiesID[c],\n                                            form: {\n                                                id: id[l],\n                                                name: name[l],\n                                                activity: activity[l],\n                                                photo: photo[l],\n                                                start: start[l],\n                                                members: members[l],\n                                                latitude: latitude[l],\n                                                longitude: longitude[l],\n                                                description: description[l]\n                                            }\n                                        }, function (err, res, body) {\n                                            if (err) {\n                                                console.log(err);\n                                            } else if (body) {\n                                                //console.log(body);\n                                            }\n                                        });\n\n                                        if (l == id.length-1) {\n                                            resolve();\n                                            console.log('DICK');\n                                            //RemoveDoubleRequest();\n                                        }\n                                    }\n\n                                })\n                                .then(() => {\n                                    console.log('DICK2');\n                                    console.log('Параметр \"с\" перед удалением дублей: ', c);\n                                    RemoveDoubleDocuments(c);\n                                })\n                        })\n                    })\n                    .catch((error) => {\n                        console.error(error);\n                    })\n            //})\n            // .catch((error) => {\n            //     console.error(error);\n            // })\n    }\n}\n\n\nfunction RemoveDoubleDocuments(c) {\n    setTimeout(function () {\n        console.log('Запрос на удаление дублей в Mongodb');\n        db.get().collection('cityevents').find({\"cityid\":CitiesID[c]}, {id:1}).sort({_id:1}).forEach(function(doc) {\n            db.get().collection('cityevents').removeOne({\n                _id:{$gt:doc._id},\n                id: doc.id\n            })\n        });\n\n    }, 1000)\n}\n\n\nfunction StartAPI() {\n    auth.run()\n        .then((token) => {\n            console.log('User token:', token);\n            vk.setToken(token);\n        })\n        .catch((error) => {\n            console.error(error);\n        })\n    for (var c = 0; c<CitiesID.length; c++) { // цикл для сбора данных по всем городам\n        for (var j = 0; j<ABC.length; j++) { // цикл для сбора данных по всем поисковым словам\n            setTimeout(parseDataViaAPI(j,c), 1000*(j+1)); // Сбор, сортировка, запись\n        }\n    }\n}\n\n\n//schedule.scheduleJob(rule, function(){\n//StartAPI();\n//});\n\n\n// Установка списка городов\n// Добавлены: Сочи\nsetCities();\n\n// API methods\n\napp.get('/', function (req, res) {\n    res.send(\"OneTwoMeet.ru started!\");\n});\n\napp.get('/events', eventsController.all);\n\napp.get('/events/:id', eventsController.findById);\n\napp.get('/cities', eventsController.allcities);\n\napp.post('/events/:cityid', eventsController.create);\n\napp.post('/cities', eventsController.createCity);\n\n//app.put('/events/:id', eventsController.update);\n\n//app.delete('/events/:id', eventsController.delete);\n\napp.delete('events/remove', eventsController.deleteDouble);\n\n\ndb.connect(\"mongodb://localhost:27017/VK_eAPI\", function (err) { // VK_eAPI or test\n    if(err) { return console.log(err); }\n    app.listen(1337, function () {\n        console.log(\"API app started\");\n    });\n});"]}