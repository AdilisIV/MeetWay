{"version":3,"sources":["app.js"],"names":[],"mappings":"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","file":"app-compiled.js","sourcesContent":["var express = require('express');\nvar bodyParser = require('body-parser');\nvar db = require('./db');\nvar eventsController = require('./controllers/events');\nvar path = require('path');\nvar request = require('request');\nvar fs = require('fs');\nvar app = express();\nconst VK = require('vk-io');\nconst { RequestError } = require('vk-io/errors'); // Возникает при проблемах в соединении или ответа сервера с ошибкой\nvar Block = require(\"control-block\").Block;\nvar http = require(\"http\");\n\nconst vk = new VK({\n    app: 5980502,\n    login: 'ilia.fyodoroff@mail.ru',\n    pass: 'zxcfghb12QLNkftMGS44078',\n    phone: '+79220291925',\n    scope: 'stats,notifications,groups,wall,pages,friends,offline,photos,market',\n    limit: 2\n});\n\nvar jquery = require('jquery');\nvar Nightmare = require('nightmare');\nnightmare = Nightmare({ show: true, dock: true });\nvar schedule = require('node-schedule');\nvar rule = new schedule.RecurrenceRule();\nrule.hour = new schedule.Range(0, 59, 7);\n\n\nvar CitiesID = ['1','2','49','96','10','37','153','60','61','72','73','95','99','104','110','119','123','151','158','133'];\n\nvar CitiesName = ['Москва','Санкт-Петербург','Екатеринбург','Нижний Тагил','Волгоград','Владивосток','Хабаровск','Казань','Калининград','Краснодар','Красноярск','Нижний Новгород','Новосибирск','Омск','Пермь','Ростов-на-Дону','Самара','Уфа','Челябинск','Сочи'];\n\nvar ABC = [\"в\",\"с\",\"до\",\"от\",\"к\",\"по\",\"и\",\"на\",\"за\",\"для\",\"фестиваль\",\"МК\",\"приз\",\"ночь\",\"концерт\",\"розыгрыш\",\"интенсив\",\"через\",\"забег\",\"поход\",\"фитнес\",\"семинар\",\"выставка\"];\n\n\napp.use(bodyParser.json({limit: '50mb'}));\napp.use(bodyParser.urlencoded({limit: '50mb', extended: true}));\nconst auth = vk.auth.standalone();\n\n\nfunction arrayUnique(arr){\n    return arr.filter((e,i,a)=>a.indexOf(e)==i)\n}\nfunction compareStart(eventA, eventB) {\n    return eventA.start - eventB.start;\n}\nfunction copyDataFromBuffer() {\n    setTimeout(function () {\n        console.log(\"copyDataFromBuffer: copyDataFromBuffer\");\n\n        db.get().collection('cityevents').remove({})\n        var documentsToMove = db.get().collection('buffercollection').find({});\n        documentsToMove.forEach(function (doc) {\n            db.get().collection('cityevents').insertOne(doc)\n        })\n    }, 500)\n}\n\n\n\n\nfunction setCities() {\n    setTimeout(function(){\n\n        db.get().collection('cities').remove({}, function (err, result) {\n            if (err) {\n                console.log(err)\n            }\n        }); // clear collection\n\n        for (var l=0; l<CitiesID.length; l++) {\n            request.post({\n                url: 'http://localhost/cities',\n                form: {\n                    id: CitiesID[l],\n                    name: CitiesName[l]\n                }\n            }, function (err, res, body) {\n                if (err) {\n                    console.log(err);\n                } else if (body) {\n                    console.log(body);\n                }\n            });\n        }\n    }, 2000);\n}\nfunction RemoveDoubleDocuments(c) {\n    setTimeout(function () {\n        console.log('Запрос на удаление дублей в Mongodb');\n        db.get().collection('buffercollection').find({\"cityid\":CitiesID[c]}, { id:1 }).sort({ _id:1 }).forEach(function(doc) {\n            db.get().collection('buffercollection').remove({\n                _id:{$gt:doc._id},\n                id: doc.id\n            },\n            function (err, result) {\n                if (err) {\n                    console.log(err)\n                }\n            })\n        })\n\n        db.get().collection('buffercollection').find({\"cityid\":CitiesID[c]}, { name:1 }).sort({ _id:1 }).forEach(function(doc) {\n            db.get().collection('buffercollection').remove({\n                _id:{$gt:doc._id},\n                name: doc.name\n            },\n            function (err, result) {\n                if (err) {\n                    console.log(err)\n                }\n            })\n        })\n\n    }, 100)\n}\n\n\n\nvar func = function (c) {\n    db.get().close();\n    db.get().open();\n    return function () {\n        for (var j = 0; j<ABC.length; j++) {\n            vk.api.groups.search({\n                    q: ABC[j],\n                    type: 'event',\n                    city_id: CitiesID[c],\n                    future: 1,\n                    offset: 0,\n                    count: 1000\n                })\n                .catch(RequestError,(error) => {\n                    console.error(`RequestError error №${error.code} ${error.message}`);\n                })\n                .catch((error) => {\n                    console.error(error);\n                })\n                .then((group) => {\n                    var result = [];\n                    console.log('Поиское слово: ', ABC[j]);\n                    try {\n                        var groupObj = JSON.stringify(group);\n                    } catch(err) { console.error(\"JSON.stringify error: \", err); }\n\n                    try {\n                        var groupJSON = JSON.parse(groupObj);\n                    } catch(err) { console.error(\"JSON.parse error: \", err); }\n\n                    for (var i = 0; i < groupJSON.items.length; i++) {\n                        result.push(groupJSON.items[i].screen_name); // все id по словарю для заданного города\n                    }\n                    result = arrayUnique(result); // удаляем дублирующиеся данные\n                    result = result.join(',');\n\n                    return result;\n                })\n                .then(function (result) {\n                    if (result == []) {\n                        console.log(\"Мероприятия по запросу отсутствуют!\")\n                    } else {\n                        vk.api.groups.getById({\n                                group_ids: result,\n                                fields: 'members_count,start_date,activity,place,description'\n                            })\n                            .catch(RequestError,(error) => {\n                                console.error(`RequestError error №${error.code} ${error.message}`);\n                            })\n                            .catch((error) => {\n                                console.error(error);\n                            })\n                            .then((data) => {\n                                try {\n                                    var dataObj = JSON.stringify(data);\n                                } catch(err) { console.error(\"JSON.stringify error: \", err); }\n                                try {\n                                    var dataJSON = JSON.parse(dataObj);\n                                } catch(err) {\n                                    console.error(\"JSON.parse error: \", err);\n                                }\n\n                                var screenname;\n                                var latitude;\n                                var longitude;\n\n                                var eventObject;\n\n                                for (var i = 0; i < dataJSON.length; i++) {\n                                    if ((dataJSON[i].members_count > 4) || (dataJSON[i].is_closed == 0)) {\n                                        if (!dataJSON[i].place) {\n                                            latitude = 0;\n                                            longitude = 0;\n                                        } else {\n                                            latitude = dataJSON[i].place.latitude;\n                                            longitude = dataJSON[i].place.longitude;\n                                        }\n\n                                        if (dataJSON[i].description == \"\") {\n                                            dataJSON[i].description = \"Упс, видимо организаторы мероприятия решили не добавлять описание. :(\";\n                                        }\n\n                                        screenname = \"https://m.vk.com/club\" + dataJSON[i].id;\n\n                                        eventObject = {\n                                            cityid: CitiesID[c],\n                                            id: dataJSON[i].id,\n                                            name: dataJSON[i].name,\n                                            activity: dataJSON[i].activity,\n                                            photo: dataJSON[i].photo_200,\n                                            start: dataJSON[i].start_date,\n                                            members: Number(dataJSON[i].members_count),\n                                            latitude: latitude,\n                                            longitude: longitude,\n                                            description: dataJSON[i].description,\n                                            screenname: screenname,\n                                            commerce: false\n                                        };\n\n\n                                        var req = request.post({\n                                            url: 'http://localhost:1337/events',\n                                            form: {\n                                                cityid: eventObject.cityid,\n                                                id: eventObject.id,\n                                                name: eventObject.name,\n                                                activity: eventObject.activity,\n                                                photo: eventObject.photo,\n                                                start: eventObject.start,\n                                                members: eventObject.members,\n                                                latitude: eventObject.latitude,\n                                                longitude: eventObject.longitude,\n                                                description: eventObject.description,\n                                                screenname: eventObject.screenname,\n                                                commerce: eventObject.commerce\n                                            }\n                                        }, function (err, res, body) {\n                                            if (err) {\n                                                console.log(err);\n                                            } else if (body) {\n                                                //console.log(body);\n                                            }\n                                        });\n                                        req.on('error', function () {\n                                            //Block.errorHandler();\n                                            console.error(\"request.post error!\");\n                                        });\n                                        process.on('uncaughtException', function (err) {\n                                            console.log(\"Тот самый uncaughtException !!!\");\n                                            console.error(err.stack);\n                                            //process.exit();\n                                        });\n\n\n                                    }\n                                }\n                            })\n                            .then(() => {\n                                console.log('Параметр \"с\" перед удалением дублей: ', c);\n                                RemoveDoubleDocuments(c);\n                            })\n                            .catch((error) => {\n                                console.error(error);\n                            })\n                    }\n                })\n                .catch((error) => {\n                    console.error(error);\n                })\n        }\n    }\n}\n\n\n//var CitiesID = ['96'];\n//var ABC = [\"в\", \"с\", \"за\", \"на\"];\n\n\nfunction StartAPI() {\n\n    setTimeout(function() {\n        db.get().collection('buffercollection').removeMany(\n            {},\n            function (err, result) {\n                if (err) {\n                    console.log(err);\n                }\n            }\n        )\n    }, 1000)\n\n    auth.run()\n        .then((token) => {\n            console.log('User token:', token);\n            vk.setToken(token);\n        })\n        .catch((error) => {\n            console.error(error);\n        })\n        .then(() => {\n            for (var c = 0; c<CitiesID.length; c++) {\n                setTimeout(func(c), 80000 * c);\n            }\n        })\n}\n\n\n\n\n\n//schedule.scheduleJob(rule, function(){\n    StartAPI();\n//});\n\n\n\n// Установка списка городов\n// Добавлены: Сочи-153\n//setCities();\n//insertDocuments();\n//copyDataFromBuffer();\n\n\n\n\n// API methods\n\napp.get('/', function (req, res) {\n    res.send(\"Server started!\");\n});\n\napp.get('/events', eventsController.all);\n\napp.get('/events/:id', eventsController.findById);\n\napp.get('/events/eventbyid/:id', eventsController.eventById);\n\napp.get('/cities', eventsController.allcities);\n\napp.get('/events/eventsByTime/:cityid/:x/:y', eventsController.eventsByTime);\n\napp.post('/events', eventsController.create);\n\napp.post('/cities', eventsController.createCity);\n\napp.put('/events/eventbyid/:id', eventsController.update);\n\napp.delete('/events/:id', eventsController.delete);\n\napp.delete('events/remove', eventsController.deleteDouble);\n\n\n\n\nvar exit = function exit() {\n    setTimeout(function () {\n        process.exit(1);\n    }, 0);\n};\n\napp.use(function (error, req, res, next) {\n    if (error.status === 400) {\n        console.info(error.body);\n        return res.send(400);\n    }\n\n    console.error(error);\n    exit();\n});\n\napp.on('error', function (message) {\n    console.error(\"[ERROR]: \", message);\n});\n\napp.setMaxListeners(1000);\n\ndb.connect(\"mongodb://localhost:27017/eventsDB\", function (err) { // VK_eAPI or test\n    if(err) { return console.log(err); }\n    app.listen(1337, function () {\n        console.log(\"API app started\");\n    });\n});\n"]}