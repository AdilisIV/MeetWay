{"version":3,"sources":["index.js"],"names":[],"mappings":"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","file":"index-compiled.js","sourcesContent":["var ElementType = require(\"domelementtype\");\n\nvar re_whitespace = /\\s+/g;\nvar NodePrototype = require(\"./lib/node\");\nvar ElementPrototype = require(\"./lib/element\");\n\nfunction DomHandler(callback, options, elementCB){\n\tif(typeof callback === \"object\"){\n\t\telementCB = options;\n\t\toptions = callback;\n\t\tcallback = null;\n\t} else if(typeof options === \"function\"){\n\t\telementCB = options;\n\t\toptions = defaultOpts;\n\t}\n\tthis._callback = callback;\n\tthis._options = options || defaultOpts;\n\tthis._elementCB = elementCB;\n\tthis.dom = [];\n\tthis._done = false;\n\tthis._tagStack = [];\n\tthis._parser = this._parser || null;\n}\n\n//default options\nvar defaultOpts = {\n\tnormalizeWhitespace: false, //Replace all whitespace with single spaces\n\twithStartIndices: false, //Add startIndex properties to nodes\n};\n\nDomHandler.prototype.onparserinit = function(parser){\n\tthis._parser = parser;\n};\n\n//Resets the handler back to starting state\nDomHandler.prototype.onreset = function(){\n\tDomHandler.call(this, this._callback, this._options, this._elementCB);\n};\n\n//Signals the handler that parsing is done\nDomHandler.prototype.onend = function(){\n\tif(this._done) return;\n\tthis._done = true;\n\tthis._parser = null;\n\tthis._handleCallback(null);\n};\n\nDomHandler.prototype._handleCallback =\nDomHandler.prototype.onerror = function(error){\n\tif(typeof this._callback === \"function\"){\n\t\tthis._callback(error, this.dom);\n\t} else {\n\t\tif(error) throw error;\n\t}\n};\n\nDomHandler.prototype.onclosetag = function(){\n\t//if(this._tagStack.pop().name !== name) this._handleCallback(Error(\"Tagname didn't match!\"));\n\tvar elem = this._tagStack.pop();\n\tif(this._elementCB) this._elementCB(elem);\n};\n\nDomHandler.prototype._addDomElement = function(element){\n\tvar parent = this._tagStack[this._tagStack.length - 1];\n\tvar siblings = parent ? parent.children : this.dom;\n\tvar previousSibling = siblings[siblings.length - 1];\n\n\telement.next = null;\n\n\tif(this._options.withStartIndices){\n\t\telement.startIndex = this._parser.startIndex;\n\t}\n\n\tif (this._options.withDomLvl1) {\n\t\telement.__proto__ = element.type === \"tag\" ? ElementPrototype : NodePrototype;\n\t}\n\n\tif(previousSibling){\n\t\telement.prev = previousSibling;\n\t\tpreviousSibling.next = element;\n\t} else {\n\t\telement.prev = null;\n\t}\n\n\tsiblings.push(element);\n\telement.parent = parent || null;\n};\n\nDomHandler.prototype.onopentag = function(name, attribs){\n\tvar element = {\n\t\ttype: name === \"script\" ? ElementType.Script : name === \"style\" ? ElementType.Style : ElementType.Tag,\n\t\tname: name,\n\t\tattribs: attribs,\n\t\tchildren: []\n\t};\n\n\tthis._addDomElement(element);\n\n\tthis._tagStack.push(element);\n};\n\nDomHandler.prototype.ontext = function(data){\n\t//the ignoreWhitespace is officially dropped, but for now,\n\t//it's an alias for normalizeWhitespace\n\tvar normalize = this._options.normalizeWhitespace || this._options.ignoreWhitespace;\n\n\tvar lastTag;\n\n\tif(!this._tagStack.length && this.dom.length && (lastTag = this.dom[this.dom.length-1]).type === ElementType.Text){\n\t\tif(normalize){\n\t\t\tlastTag.data = (lastTag.data + data).replace(re_whitespace, \" \");\n\t\t} else {\n\t\t\tlastTag.data += data;\n\t\t}\n\t} else {\n\t\tif(\n\t\t\tthis._tagStack.length &&\n\t\t\t(lastTag = this._tagStack[this._tagStack.length - 1]) &&\n\t\t\t(lastTag = lastTag.children[lastTag.children.length - 1]) &&\n\t\t\tlastTag.type === ElementType.Text\n\t\t){\n\t\t\tif(normalize){\n\t\t\t\tlastTag.data = (lastTag.data + data).replace(re_whitespace, \" \");\n\t\t\t} else {\n\t\t\t\tlastTag.data += data;\n\t\t\t}\n\t\t} else {\n\t\t\tif(normalize){\n\t\t\t\tdata = data.replace(re_whitespace, \" \");\n\t\t\t}\n\n\t\t\tthis._addDomElement({\n\t\t\t\tdata: data,\n\t\t\t\ttype: ElementType.Text\n\t\t\t});\n\t\t}\n\t}\n};\n\nDomHandler.prototype.oncomment = function(data){\n\tvar lastTag = this._tagStack[this._tagStack.length - 1];\n\n\tif(lastTag && lastTag.type === ElementType.Comment){\n\t\tlastTag.data += data;\n\t\treturn;\n\t}\n\n\tvar element = {\n\t\tdata: data,\n\t\ttype: ElementType.Comment\n\t};\n\n\tthis._addDomElement(element);\n\tthis._tagStack.push(element);\n};\n\nDomHandler.prototype.oncdatastart = function(){\n\tvar element = {\n\t\tchildren: [{\n\t\t\tdata: \"\",\n\t\t\ttype: ElementType.Text\n\t\t}],\n\t\ttype: ElementType.CDATA\n\t};\n\n\tthis._addDomElement(element);\n\tthis._tagStack.push(element);\n};\n\nDomHandler.prototype.oncommentend = DomHandler.prototype.oncdataend = function(){\n\tthis._tagStack.pop();\n};\n\nDomHandler.prototype.onprocessinginstruction = function(name, data){\n\tthis._addDomElement({\n\t\tname: name,\n\t\tdata: data,\n\t\ttype: ElementType.Directive\n\t});\n};\n\nmodule.exports = DomHandler;\n"]}