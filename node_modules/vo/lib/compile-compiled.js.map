{"version":3,"sources":["compile.js"],"names":[],"mappings":"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","file":"compile-compiled.js","sourcesContent":["/**\n * Module Dependencies\n */\n\nvar error = require('combine-errors')\nvar wrapped = require('./wrap')\nvar sliced = require('sliced')\nvar type = require('./type')\nvar co = require('co')\nvar keys = Object.keys\n\n/**\n * Export `compile`\n */\n\nmodule.exports = compile\n\n/**\n * Compile\n */\n\nfunction compile (mixed) {\n  switch (type(mixed)) {\n    case 'generator': return generator(mixed)\n    case 'promise': return promise(mixed)\n    case 'function': return Func(mixed)\n    case 'object': return object(mixed)\n    case 'catch': return Catcher(mixed)\n    case 'array': return array(mixed)\n    case 'vo': return Vo(mixed)\n    default: return Identity(mixed)\n  }\n}\n\n/**\n * Wrap functions\n *\n * @param {Function} fn\n * @return {Function}\n */\n\nfunction Func (fn) {\n  return function func (args, done) {\n    wrapped(fn, next).call(this, args)\n\n    function next(err) {\n      if (err) return done.apply(null, [err].concat(sliced(arguments)))\n      return done.apply(null, arguments)\n    }\n  }\n}\n\n/**\n * Handle already pending promises\n *\n * @param {Promise} p\n * @return {Function}\n */\n\nfunction promise (p) {\n  return function prom (args, done) {\n    return p\n      .then(function (value) { return done(null, value) })\n      .catch(function (err) { return done(err) })\n  }\n}\n\n/**\n * Handle already initialized generators\n *\n * @param {Promise} p\n * @return {Function}\n */\n\nfunction generator (g) {\n  return function gen (args, done) {\n    return co(g)(done)\n  }\n}\n\n/**\n * Wrap Objects\n *\n * @param {Object|Array} iterable\n * @return {Function}\n */\n\nfunction object (o) {\n  // compile the object\n  o = keys(o).reduce(function (o, k) {\n    o[k] = compile(o[k])\n    return o\n  }, o)\n\n  return function obj (args, done) {\n    var pending = keys(o).length\n    var context = this\n    var errors = []\n    var out = {}\n\n    // if we don't have any pending\n    // values, return immediately\n    if (!pending) return done(null, out)\n\n    keys(o).map(function(k, i) {\n      o[k].call(context, args, function(err, args) {\n        if (err) {\n          errors[i] = err\n          out[k] = err\n        } else {\n          out[k] = args\n        }\n\n        if (!--pending) {\n          errors = compact(errors)\n          return errors.length\n            ? done(error(errors), out)\n            : done(null, out)\n        }\n      })\n    })\n  }\n}\n\n/**\n * Wrap Arrays\n */\n\nfunction array (a) {\n  a = a.map(compile)\n\n  return function arr (args, done) {\n    var pending = a.length\n    var context = this\n    var errors = []\n    var out = []\n\n    // if we don't have any pending\n    // values, return immediately\n    if (!pending) return done(null, out)\n\n    // run in parallel\n    a.map(function (fn, i) {\n      fn.call(context, args, function(err, args) {\n        if (err) {\n          errors[i] = err\n          out[i] = err\n        } else {\n          out[i] = args\n        }\n\n        if (!--pending) {\n          errors = compact(errors)\n          return errors.length\n            ? done(error(errors), out)\n            : done(null, out)\n        }\n      })\n    })\n  }\n}\n\n/**\n * Wrap vo\n *\n * @param {Vo} vo\n * @return {Function}\n */\n\nfunction Vo (v) {\n  return function vo (args, done) {\n    return v.apply(this, args.concat(function(err, v) {\n      if (err) return done(error(err))\n      return done.apply(null, arguments)\n    }))\n  }\n}\n\n/**\n * Catcher\n *\n * @param {Function} fn\n * @return {Function}\n */\n\nfunction Catcher(fn) {\n  function catcher (err, args, done) {\n    return wrapped(fn(), done).call(this, [err].concat(args))\n  }\n  catcher.__catch__ = true\n  return catcher\n}\n\n/**\n * Identity\n *\n * @param {Array} args\n * @param {Function} done\n */\n\nfunction Identity (value) {\n  return function identity (args, done) {\n    return done(null, value)\n  }\n}\n\n/**\n * Compact\n */\n\nfunction compact (arr) {\n  return arr.filter(function (item) {\n    return !!item\n  })\n}\n"]}