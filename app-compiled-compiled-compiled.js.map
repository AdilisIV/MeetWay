{"version":3,"sources":["app-compiled-compiled.js"],"names":[],"mappings":"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","file":"app-compiled-compiled-compiled.js","sourcesContent":["var express = require('express');\nvar bodyParser = require('body-parser');\nvar db = require('./db');\nvar eventsController = require('./controllers/events');\nvar path = require('path');\nvar request = require('request');\nvar fs = require('fs');\nvar app = express();\nconst VK = require('vk-io');\nconst { RequestError } = require('vk-io/errors'); // Возникает при проблемах в соединении или ответа сервера с ошибкой\n\nconst vk = new VK({\n    app: 5980502,\n    login: 'ilia.fyodoroff@mail.ru',\n    pass: 'zxcfghb12QLNkftMGS44078',\n    phone: '+79220291925',\n    scope: 'stats,notifications,groups,wall,pages,friends,offline,photos,market',\n    limit: 2\n});\n\nvar jquery = require('jquery');\nvar Nightmare = require('nightmare');\nnightmare = Nightmare({ show: true, dock: true });\nvar schedule = require('node-schedule');\nvar rule = new schedule.RecurrenceRule();\nrule.hour = new schedule.Range(0, 59, 8);\n\nvar CitiesID = ['96', '1', '2', '10', '37', '153', '49', '60', '61', '72', '73', '95', '99', '104', '110', '119', '123', '151', '158', '133', '506'];\n\nvar CitiesName = ['Нижний Тагил', 'Москва', 'Санкт-Петербург', 'Волгоград', 'Владивосток', 'Хабаровск', 'Екатеринбург', 'Казань', 'Калининград', 'Краснодар', 'Красноярск', 'Нижний Новгород', 'Новосибирск', 'Омск', 'Пермь', 'Ростов-на-Дону', 'Самара', 'Уфа', 'Челябинск', 'Сочи', \"Санкт-Петербург-506\"];\n\nvar ABC = [\"в\", \"с\", \"до\", \"от\", \"к\", \"по\", \"и\", \"на\", \"за\", \"для\", \"фестиваль\", \"МК\", \"приз\", \"ночь\", \"концерт\", \"розыгрыш\", \"интенсив\", \"через\", \"забег\", \"поход\", \"фитнес\", \"семинар\", \"выставка\"];\n\napp.use(bodyParser.json());\napp.use(bodyParser.urlencoded({ extended: true }));\nconst auth = vk.auth.standalone();\n\nfunction arrayUnique(arr) {\n    return arr.filter((e, i, a) => a.indexOf(e) == i);\n}\nfunction compareStart(eventA, eventB) {\n    return eventA.start - eventB.start;\n}\nfunction setCities() {\n    setTimeout(function () {\n\n        db.get().collection('cities').remove({}); // clear collection\n\n        for (var l = 0; l < CitiesID.length; l++) {\n            request.post({\n                url: 'http://localhost/cities',\n                form: {\n                    id: CitiesID[l],\n                    name: CitiesName[l]\n                }\n            }, function (err, res, body) {\n                if (err) {\n                    console.log(err);\n                } else if (body) {\n                    console.log(body);\n                }\n            });\n        }\n    }, 2000);\n}\nfunction RemoveDoubleDocuments(c) {\n    setTimeout(function () {\n        console.log('Запрос на удаление дублей в Mongodb');\n        db.get().collection('cityevents').find({ \"cityid\": CitiesID[c] }, { id: 1 }).sort({ _id: 1 }).forEach(function (doc) {\n            db.get().collection('cityevents').remove({\n                _id: { $gt: doc._id },\n                id: doc.id\n            }).catch(err => {\n                console.error(\"Ошибка запросе на удаление дублей: \", err);\n            });\n        });\n\n        db.get().collection('cityevents').find({ \"cityid\": CitiesID[c] }, { name: 1 }).sort({ _id: 1 }).forEach(function (doc) {\n            db.get().collection('cityevents').remove({\n                _id: { $gt: doc._id },\n                name: doc.name\n            }).catch(err => {\n                console.error(\"Ошибка запросе на удаление дублей: \", err);\n            });\n        });\n    }, 100);\n}\n\nfunction insertDocuments() {\n    setTimeout(function () {\n\n        console.log('insertDocuments');\n\n        db.get().collection('cityevents').remove({}); // clear collection\n\n        db.get().collection('cityevents').insert({\n            \"cityid\": \"506\",\n            \"id\": \"27823606\",\n            \"name\": \"Фестиваль экологии Представь Зелёное: Движение\",\n            \"activity\": \"21 июл 2017 в 12:00\",\n            \"photo\": \"https://pp.userapi.com/c840122/v840122433/d956/RjmvJsLopuk.jpg\",\n            \"start\": 1500620400,\n            \"members\": 3744,\n            \"latitude\": 59.932378,\n            \"longitude\": 30.321042,\n            \"description\": \"Что общего между наукой, искусством, модой, архитектурой, косметикой и едой? Все эти сферы могут быть экологичными - созданными с заботой о природе и человеке. На большом фестивале экологии Представь Зелёное гости смогут:  - Посетить познавательные лекции, эко-маркет, выставки арт-объектов, кинопоказы, спектакли о планете и концерты;  - Поиграть в настольные эко-игры и квесты;  - Поучаствовать в круглых столах, мастер-классах по рециклинг-творчеству и в кулинарных вегетарианских мастер-классах от общественных организаций и заведений города.\",\n            \"screenname\": \"https://m.vk.com/club27823606\",\n            \"commerce\": false\n        });\n\n        db.get().collection('cityevents').insert({\n            \"cityid\": \"506\",\n            \"id\": \"32814569\",\n            \"name\": \"Интеллигентная барахолка - дизайн-маркет в СПБ\",\n            \"activity\": \"21 июл 2017 в 13:00\",\n            \"photo\": \"https://pp.userapi.com/c836528/v836528609/48605/G4iAW2aXBDM.jpg\",\n            \"start\": 1500631200,\n            \"members\": 14795,\n            \"latitude\": 59.92887,\n            \"longitude\": 30.344219,\n            \"description\": \"Интеллигентная барахолка – дизайн-маркет с четырехлетней историей, особой атмосферой и непростым характером; большой, нарядный и разношерстный праздник экзальтированных дам, понаехавших денди и петербургских модников.\",\n            \"screenname\": \"https://m.vk.com/club32814569\",\n            \"commerce\": false\n        });\n\n        db.get().collection('cityevents').insert({\n            \"cityid\": \"506\",\n            \"id\": \"150196755\",\n            \"name\": \"Рисование вином и дегустация. СПБ - 21 июля\",\n            \"activity\": \"21 июл 2017 в 13:00\",\n            \"photo\": \"https://pp.userapi.com/c638830/v638830146/4893e/i4-NkrRqsvs.jpg\",\n            \"start\": 1500634800,\n            \"members\": 5,\n            \"latitude\": 0,\n            \"longitude\": 0,\n            \"description\": \"Новый проект от [club96773634|Студии Рисования&#9679;ZUART&#9679;] и винного клуба [club147593638|ART of Wine]! Арт-дегустация – это новый формат мероприятия, соединяющий в себе живопись и винное искусство. В этот вечер мы продегустируем 3 бутылочки изысканного вина и нарисуем картину вином! Наш проект создан для творческих людей, кто увлекается искусством, современными техниками рисования и кто любит дегустировать эксклюзивные вина или хотел бы научиться в них разбираться.\",\n            \"screenname\": \"https://m.vk.com/club150196755\",\n            \"commerce\": false\n        });\n\n        db.get().collection('cityevents').insert({\n            \"cityid\": \"506\",\n            \"id\": \"78907820\",\n            \"name\": \"ВЕГАН ФЕСТ | До встречи осенью!\",\n            \"activity\": \"21 июл 2017 в 14:00\",\n            \"photo\": \"https://pp.userapi.com/c639828/v639828106/25399/6-1TeHOeUAw.jpg\",\n            \"start\": 1500635900,\n            \"members\": 5230,\n            \"latitude\": 59.950767,\n            \"longitude\": 30.245988,\n            \"description\": \"– Ваша любимая веганская еда и продукция этичных производителей; – интересные лекции и полезные мастер-классы; – спорт, веселье, игры и общение; – игровая и образовательная программа для деток; – дегустации, конкурсы и подарки! Вход бесплатный!\",\n            \"screenname\": \"https://m.vk.com/club78907820\",\n            \"commerce\": false\n        });\n\n        db.get().collection('cityevents').insert({\n            \"cityid\": \"506\",\n            \"id\": \"110931219\",\n            \"name\": \"Мастер-класс от 78 Glass. МК по стеклодувному мастерству\",\n            \"activity\": \"21 июл 2017 в 14:00\",\n            \"photo\": \"https://pp.userapi.com/c604819/v604819831/3c587/igEaS2bT5QQ.jpg\",\n            \"start\": 1500636900,\n            \"members\": 87,\n            \"latitude\": 0,\n            \"longitude\": 0,\n            \"description\": \"Cерия индивидуальных мастер-классов. Записывайтесь в удобное для Вас время. В рамках мастер-класса Вам (участнику или группе участников 2-3 человека) представится возможность поработать за стеклодувными горелками, познакомиться с физикой стекла, освоить базовые техники работы и декорирования. Все необходимое оборудования для работы предоставляется. Стоимость участия: 5000 рублей. Продолжительность: 2-3 часа. Запись и расписание уточняйте в сообщениях сообщества. Мастерская находится на улице Профессора Попова 38. (метро Петрогадская / Чкаловская )\",\n            \"screenname\": \"https://m.vk.com/club110931219\",\n            \"commerce\": false\n        });\n    }, 1000);\n}\n\nvar func = function (c) {\n    return function () {\n        for (var j = 0; j < ABC.length; j++) {\n            vk.api.groups.search({\n                q: ABC[j],\n                type: 'event',\n                city_id: CitiesID[c],\n                future: 1,\n                offset: 0,\n                count: 1000\n            }).catch(RequestError, error => {\n                console.error(`RequestError error №${error.code} ${error.message}`);\n            }).catch(error => {\n                console.error(error);\n            }).then(group => {\n                var result = [];\n                console.log('Поиское слово: ', ABC[j]);\n\n                var groupObj = JSON.stringify(group);\n                var groupJSON = JSON.parse(groupObj);\n                for (var i = 0; i < groupJSON.items.length; i++) {\n                    result.push(groupJSON.items[i].screen_name); // все id по словарю для заданного города\n                }\n                result = arrayUnique(result); // удаляем дублирующиеся данные\n                result = result.join(',');\n\n                return result;\n            }).then(function (result) {\n                //console.log(result)\n                vk.api.groups.getById({\n                    group_ids: result,\n                    fields: 'members_count,start_date,activity,place,description'\n                }).catch(RequestError, error => {\n                    console.error(`RequestError error №${error.code} ${error.message}`);\n                }).catch(error => {\n                    console.error(error);\n                }).then(data => {\n                    var dataObj = JSON.stringify(data);\n                    var dataJSON = JSON.parse(dataObj);\n\n                    var id = [];\n                    var name = [];\n                    var activity = [];\n                    var photo = [];\n                    var start = [];\n                    var members = [];\n                    var latitude = [];\n                    var longitude = [];\n                    var description = [];\n                    var screenname = [];\n                    var commerce = [];\n\n                    for (var i = 0; i < dataJSON.length; i++) {\n                        if (dataJSON[i].members_count > 4 || dataJSON[i].is_closed == 0) {\n                            if (dataJSON[i].place) {\n                                latitude.push(dataJSON[i].place.latitude);\n                                longitude.push(dataJSON[i].place.longitude);\n                            } else {\n                                latitude.push(0);\n                                longitude.push(0);\n                            }\n\n                            if (dataJSON[i].description != \"\") {\n                                description.push(dataJSON[i].description);\n                            } else {\n                                description.push(\"Упс, видимо организаторы мероприятия решили не добавлять описание. :(\");\n                            }\n\n                            id.push(dataJSON[i].id);\n                            name.push(dataJSON[i].name);\n                            activity.push(dataJSON[i].activity);\n                            photo.push(dataJSON[i].photo_200);\n                            start.push(dataJSON[i].start_date);\n                            members.push(dataJSON[i].members_count);\n                            screenname.push(\"https://m.vk.com/club\" + dataJSON[i].id);\n                            commerce.push(false);\n                        }\n                    }\n\n                    for (var l = 0; l < id.length; l++) {\n                        request.post({\n                            url: 'http://localhost/events/' + CitiesID[c],\n                            form: {\n                                id: id[l],\n                                name: name[l],\n                                activity: activity[l],\n                                photo: photo[l],\n                                start: start[l],\n                                members: members[l],\n                                latitude: latitude[l],\n                                longitude: longitude[l],\n                                description: description[l],\n                                screenname: screenname[l],\n                                commerce: commerce[l]\n                            }\n                        }, function (err, res, body) {\n                            if (err) {\n                                console.log(err);\n                            } else if (body) {\n                                //console.log(body);\n                            }\n                        });\n                    }\n                }).then(() => {\n                    console.log('Параметр \"с\" перед удалением дублей: ', c);\n                    RemoveDoubleDocuments(c);\n                }).catch(error => {\n                    console.error(error);\n                });\n            }).catch(error => {\n                console.error(error);\n            });\n        }\n    };\n};\n\n//var CitiesID = ['96','1','2','10','37','153','49','60'];\n//var CitiesID = ['49'];\n//var ABC = [\"в\",\"с\",\"до\",\"от\",\"фестиваль\"];\n\n\nfunction StartAPI() {\n\n    setTimeout(function () {\n        db.get().collection('cityevents').remove({}); // clear collection\n    }, 1000);\n\n    auth.run().then(token => {\n        console.log('User token:', token);\n        vk.setToken(token);\n    }).catch(error => {\n        console.error(error);\n    }).then(() => {\n        for (var c = 0; c < CitiesID.length; c++) {\n            setTimeout(func(c), 15000 * c);\n        }\n    });\n}\n\n//schedule.scheduleJob(rule, function(){\nStartAPI();\n//});\n\n\n// Установка списка городов\n// Добавлены: Сочи\n//setCities();\n//insertDocuments();\n\n\n// API methods\n\napp.get('/', function (req, res) {\n    res.send(\"Server started!\");\n});\n\napp.get('/events', eventsController.all);\n\napp.get('/events/:id', eventsController.findById);\n\napp.get('/events/eventbyid/:id', eventsController.eventById);\n\napp.get('/cities', eventsController.allcities);\n\napp.get('/events/eventsByTime/:cityid/:x/:y', eventsController.eventsByTime);\n\napp.post('/events/:cityid', eventsController.create);\n\napp.post('/cities', eventsController.createCity);\n\napp.put('/events/eventbyid/:id', eventsController.update);\n\napp.delete('/events/:id', eventsController.delete);\n\napp.delete('events/remove', eventsController.deleteDouble);\n\napp.use(function (err, req, res, next) {\n    res.status(err.status || 500);\n});\n\napp.on('error', function (message) {\n    console.error(\"[ERROR]: \", message);\n});\n\ndb.connect(\"mongodb://localhost:27017/eventsDB\", function (err) {\n    // VK_eAPI or test\n    if (err) {\n        return console.log(err);\n    }\n    app.listen(80, function () {\n        console.log(\"API app started\");\n    });\n});\n\n//# sourceMappingURL=app-compiled.js.map\n\n//# sourceMappingURL=app-compiled-compiled.js.map"]}